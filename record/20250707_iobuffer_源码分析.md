## 1. 整体框架（Ping-Pong 双 Bank）

                 ┌───────── Mem_Ctrl 给 wr_addr / rd_addr ─────────┐
                 │                                                │
┌── 写数据选择 ──┤                                       ┌─ Bank-0 : map_10-17  ──┤─► PE 输入
│                            │                                       │                                        │
│                            │ Layer 偶 → 写 Bank-0   │ 读 Bank-1                        │
│ IOB_Data_vld ─►│ Layer 奇 → 写 Bank-1   │ 读 Bank-0                        │
└────────────────┘                                     └───────────────────────┘
## 2.关键握手关系

| 信号                    | 生产者      | 消费者                       | 作用     |
| --------------------- | -------- | ------------------------- | ------ |
| `wr_addr` / `rd_addr` | Mem_Ctrl | 本模块 16×RAM                | 地址统一   |
| `IOB_Data_vld`        | 输入阶段逻辑   | 写端 `wen_ram?`             | 写同步    |
| `Mem_Data_Ivld`       | Mem_Ctrl | 读端 enb + `IOB_Data_O_vld` | 读同步    |
| `IOB_Data_O_vld`      | 本模块      | Input_Regfile             | 数据到齐标志 |

- 写：IOB_Data_vld 必须与 8×Byte 同拍 → 地址、数据、wen 都在 同一拍。
- 读：Mem_Data_Ivld 必须与 rd_addr 同拍给 RAM，读出数据再经过 2 个 BRAM latency (2clk)，到 Input_Regfile 时用 IOB_Data_O_vld 对齐。
B口写，A口读

**`Mem_Data_Ivld`就是mem的`Data_O_vld`**	

| 网络阶段                 | 需要缓存到 BRAM 的 **最大**特征图        | 点数 (= W × H × C)        | 每 Bank 存 8 Byte需要多少行？ | 2048 行是否足够 |
| -------------------- | ----------------------------- | ----------------------- | --------------------- | ---------- |
| **卷积层 1** 输入 (原 ECG) | 64 × 64 × 3 = **12 288** Byte | 12 288 ÷ 8 = **1536** 行 | 1536 ≤ 2048           | ✔          |
| 卷积层 1 输出 / 卷积层 2 输入  | 32 × 32 × 8 = **8192** Byte   | 8192 ÷ 8 = **1024** 行   | 1024 ≤ 2048           | ✔          |
| 卷积层 2 输出 / Pool 输入   | 16 × 16 × 32 = **8192** Byte  | 8192 ÷ 8 = **1024** 行   | 1024 ≤ 2048           | ✔          |
| Pool 输出 / FC1 输入     | 3 × 3 × 32 = **288** Byte     | 288 ÷ 8 = **36** 行      | 36 ≪ 2048             | ✔          |