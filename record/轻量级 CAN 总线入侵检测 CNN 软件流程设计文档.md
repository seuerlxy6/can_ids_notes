



---

## 1 文档目的与适用范围

本说明面向**研究生级别的算法/系统开发者**，帮助你在**不接触硬件实现细节**的前提下快速复现论文中的软件流程——从原始 CAN 报文到压缩后的 CNN 模型。全文力求用**通俗中文**解释关键步骤，并附上必须的技术参数，既方便理解又便于落地。

---

## 2 整体数据管线（文字示意）

```
① 原始 CAN 日志                                            
        │ 16 帧滑窗
② 16×16×3 CAN‑RGB 张量 ----------------┐                  
        │ 2× 双线性放大               │                  
        └─────────────► ③ 64×64×3 图像 ─► ④ 轻量 CNN (CANET‑33K) ─► ⑤ Softmax ─► 攻击/正常标签
                                                       │
                                                       └─► ⑥ 一次式剪枝 + INT8 量化 → 部署模型
```

**一句话理解**：先把串行报文变成「彩色小图」，再用极简 CNN 识别是否异常，并在最后一步把模型压到汽车 ECU 也放得下的大小。

---

## 3 阶段一：CAN‑RGB 编码

> **为什么要编码成图像？** 人类肉眼很擅长识别颜色纹理异常，CNN 也是如此——只要把时间、ID、数据长度这些维度巧妙挤进 RGB 通道，网络就能像看图片那样发现入侵痕迹。

| 信息维度           | 映射规则                     | 背后直观解释           |
| -------------- | ------------------------ | ---------------- |
| **时序**         | 第 _k_ 帧 → 第 _k_ 行        | 把时间顺序竖着排，不打乱事件流  |
| **DLC（数据长度码）** | DLC 取值 0‑8 → 第 _x_ 列     | 不同长度的报文横向分布，形成纹理 |
| **ID**         | ID 低 12 位 → RGB 颜色（线性映射） | 颜色越“怪”，ID 越可能被伪造 |
| **空位**         | 填黑                       | 背景干净，特征更突出       |

编码后得到 **16×16×3** 的小张量，再放大到 **64×64** 供 CNN 提取更细纹理。

---

## 4 阶段二：轻量 CNN（CANET‑33K）

> **核心思路**：用最少层数和参数在 2 × 2 ms 级推理时限内跑完。

- **结构简洁**：3 个卷积区块（带 stride 直接下采样）+ 1 个 MaxPool + 两层极瘦的全连接。
    
- **参数量**：32 962（FP32 下仅 132 kB）。
    
- **算力需求**：约 2.31 M MACs，一块低端 MCU 都能应付。
    

|层级|配置|输出尺寸|参数量|
|---|---|---|---|
|Conv1|3→16, 3×3, s2|16×32×32|448|
|Conv2|16→32, 3×3, s2|32×16×16|4 640|
|Conv3|32→32, 3×3, s2|32×8×8|9 248|
|MaxPool|4×4, s2|32×3×3|0|
|FC1|288→64|64|18 432|
|FC2|64→2|2|130|

> **通俗比喻**：把大房间（64×64×3）一口气缩到手机屏，然后再用少量“侦探”（卷积核）抓嫌疑点。

---

## 5 阶段三：一次式混合压缩（剪枝 + INT8 量化）

为什么能一步到位？因为**通道剪枝**+**后训练静态量化**互不冲突，可连贯流水：

|步骤|关键操作|结果|
|---|---|---|
|**结构化剪枝**|L1‑norm 选最弱通道删掉一半；FC 单元砍 3/4；再微调 10 个 epoch|参数 ↓78 % → 7 208；MACs ↓62 % → 0.88 M；精度仍 99.72 %|
|**INT8 PTQ**|用 1 万张未见过的样本做校准，fbgemm 后端|文件尺寸 ↓到 17 kB；精度无损|

> **一句话**：7× 压缩 + 无精度损失，把“瘦身”做到极致。

---

## 6 训练与评估设置

- **数据集**：公开多攻击类型 CAN 日志，共 124 k 张编码图。
    
- **划分**：8:1:1（Train:Val:Test），额外 10 k 张做量化校准。
    
- **优化器**：Adam，批量 32；学习率余弦退火。
    
- **指标**：Accuracy/F1/FNR + 参数量、模型大小、MACs。
    

> 通过 Early‑Stopping，可在 15‑20 分钟内用 CPU 完成本地微调。

---

## 7 主要实验对比

|模型|尺寸|MACs|准确率|
|---|---|---|---|
|Inception‑ResNet|7 MB|18 M|99.9 %|
|Gao 2023 轻量 CNN|280 kB|—|99.7 %|
|**本工作 INT8**|**17 kB**|0.88 M|**99.72 %**|

> 结果说明：在尺寸上 **比深模型小 410 倍**，性能几乎相当；非常适合资源受限的车载 ECU。

---

## 8 假设与局限

- 只覆盖 DoS、Fuzzy、Gear、RPM 四类攻击。
    
- 滑窗固定 16 帧，未尝试自适应大小。
    
- 使用 8bit 对称量化，更低位宽留待后续研究。
    

---

## 9 后续改进方向

1. **量化感知训练（QAT）**：进一步恢复极端剪枝场景的精度。
    
2. **稀疏训练**：尝试 Lottery Ticket / SLT 方案，冲击 <10 k 参数。
    
3. **硬件闭环验证**：把 INT8 模型烧录到 MCU/FPGA，实测端到端延迟；对比 ECU 实时窗口需求。
    

---

## 10 参考文献

- Liu, X. 等. 《轻量级 CNN 用于 CAN 总线入侵检测》, 2025. fileciteturn0file0